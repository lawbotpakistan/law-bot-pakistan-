"use strict";(()=>{var a={};a.id=875,a.ids=[220,875],a.modules={361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:a=>{a.exports=require("react")},2235:(a,b,c)=>{c.r(b),c.d(b,{config:()=>y,default:()=>u,getServerSideProps:()=>x,getStaticPaths:()=>w,getStaticProps:()=>v,handler:()=>G,reportWebVitals:()=>z,routeModule:()=>F,unstable_getServerProps:()=>D,unstable_getServerSideProps:()=>E,unstable_getStaticParams:()=>C,unstable_getStaticPaths:()=>B,unstable_getStaticProps:()=>A});var d={};c.r(d),c.d(d,{config:()=>m,default:()=>s});var e=c(3885),f=c(237),g=c(1413),h=c(3317),i=c.n(h),j=c(6195),k=c.n(j),l=c(3939);let m={runtime:"nodejs"},n=process.env.SUPABASE_URL,o=process.env.SUPABASE_ANON_KEY,p=process.env.SUPABASE_SERVICE_ROLE_KEY,q=(0,l.createClient)(n,o),r=(0,l.createClient)(n,p);async function s(a,b){if("POST"!==a.method)return b.status(405).json({error:"Method not allowed"});try{let c=(a.headers.authorization||"").split(" ")[1];if(!c)return b.status(401).json({error:"Missing token"});let{data:d,error:e}=await q.auth.getUser(c);if(e||!d?.user)return b.status(401).json({error:"Invalid token"});let f=d.user,{data:g,error:h}=await r.from("profiles").select("is_admin").eq("id",f.id).single();if(h)return b.status(500).json({error:"Failed to load profile"});if(!g?.is_admin)return b.status(403).json({error:"Not admin"});let{paymentId:i,newStatus:j,adminReason:k}=a.body;if(!i||!["approved","rejected"].includes(j))return b.status(400).json({error:"Invalid input"});let{error:l}=await r.from("payments").update({status:j,reviewed_at:new Date().toISOString(),admin_reason:k||null,processed_by:f.id}).eq("id",i);if(l)return b.status(500).json({error:l.message});return b.status(200).json({ok:!0})}catch(a){return console.error("admin/approve error:",a),b.status(500).json({error:"Internal server error"})}}var t=c(2289);let u=(0,g.M)(d,"default"),v=(0,g.M)(d,"getStaticProps"),w=(0,g.M)(d,"getStaticPaths"),x=(0,g.M)(d,"getServerSideProps"),y=(0,g.M)(d,"config"),z=(0,g.M)(d,"reportWebVitals"),A=(0,g.M)(d,"unstable_getStaticProps"),B=(0,g.M)(d,"unstable_getStaticPaths"),C=(0,g.M)(d,"unstable_getStaticParams"),D=(0,g.M)(d,"unstable_getServerProps"),E=(0,g.M)(d,"unstable_getServerSideProps"),F=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/admin/approve",pathname:"/admin/approve",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:k(),Document:i()},userland:d}),G=(0,t.U)({srcPage:"/admin/approve",config:y,userland:d,routeModule:F,getStaticPaths:w,getStaticProps:v,getServerSideProps:x})},3873:a=>{a.exports=require("path")},3939:a=>{a.exports=require("@supabase/supabase-js")},6060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},8732:a=>{a.exports=require("react/jsx-runtime")}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[317,871],()=>b(b.s=2235));module.exports=c})();