"use strict";(()=>{var e={};e.id=637,e.ids=[637,888,660],e.modules={289:(e,r,t)=>{t.r(r),t.d(r,{config:()=>j,default:()=>P,getServerSideProps:()=>h,getStaticPaths:()=>f,getStaticProps:()=>b,reportWebVitals:()=>w,routeModule:()=>y,unstable_getServerProps:()=>k,unstable_getServerSideProps:()=>q,unstable_getStaticParams:()=>E,unstable_getStaticPaths:()=>A,unstable_getStaticProps:()=>x});var s={};t.r(s),t.d(s,{config:()=>c,default:()=>handler});var a=t(93),o=t(244),n=t(323),i=t(209),l=t.n(i),u=t(337),d=t.n(u),p=t(885);let c={runtime:"nodejs"},S=process.env.SUPABASE_URL,_=process.env.SUPABASE_ANON_KEY,g=process.env.SUPABASE_SERVICE_ROLE_KEY,m=(0,p.createClient)(S,_),v=(0,p.createClient)(S,g);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let t=e.headers.authorization||"",s=t.split(" ")[1];if(!s)return r.status(401).json({error:"Missing token"});let{data:a,error:o}=await m.auth.getUser(s);if(o||!a?.user)return r.status(401).json({error:"Invalid token"});let n=a.user,{data:i,error:l}=await v.from("profiles").select("is_admin").eq("id",n.id).single();if(l)return r.status(500).json({error:"Failed to load profile"});if(!i?.is_admin)return r.status(403).json({error:"Not admin"});let{paymentId:u,newStatus:d,adminReason:p}=e.body;if(!u||!["approved","rejected"].includes(d))return r.status(400).json({error:"Invalid input"});let{error:c}=await v.from("payments").update({status:d,reviewed_at:new Date().toISOString(),admin_reason:p||null,processed_by:n.id}).eq("id",u);if(c)return r.status(500).json({error:c.message});return r.status(200).json({ok:!0})}catch(e){return console.error("admin/approve error:",e),r.status(500).json({error:"Internal server error"})}}let P=(0,n.l)(s,"default"),b=(0,n.l)(s,"getStaticProps"),f=(0,n.l)(s,"getStaticPaths"),h=(0,n.l)(s,"getServerSideProps"),j=(0,n.l)(s,"config"),w=(0,n.l)(s,"reportWebVitals"),x=(0,n.l)(s,"unstable_getStaticProps"),A=(0,n.l)(s,"unstable_getStaticPaths"),E=(0,n.l)(s,"unstable_getStaticParams"),k=(0,n.l)(s,"unstable_getServerProps"),q=(0,n.l)(s,"unstable_getServerSideProps"),y=new a.PagesRouteModule({definition:{kind:o.x.PAGES,page:"/admin/approve",pathname:"/admin/approve",bundlePath:"",filename:""},components:{App:d(),Document:l()},userland:s})},885:e=>{e.exports=require("@supabase/supabase-js")},785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},689:e=>{e.exports=require("react")},17:e=>{e.exports=require("path")}};var r=require("../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[514,209,337,450],()=>__webpack_exec__(289));module.exports=t})();